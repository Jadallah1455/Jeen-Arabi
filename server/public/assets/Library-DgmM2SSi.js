import{j as n,D as Z,P as V,v as J,G as K}from"./pdf-D5M-G2vY.js";import{e as E,r as x,i as Q}from"./vendor-CvWOdSKG.js";import{T as tt}from"./index-BxkEYnYd.js";import{D as F,f as et,g as it,V as st,h as nt,X as Y,j as O,k as at,C as rt,R as ot,l as ht,E as G,m as U,I as lt,n as dt}from"./ui-DVHeSrky.js";import"./utils-B9ygI19o.js";var H={exports:{}},ct=H.exports,q;function gt(){return q||(q=1,(function(d,k){(function(R,S){S(k)})(ct,(function(R){class S{constructor(t,e){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=e,this.nowDrawingDensity=this.createdDensity,this.render=t}setDensity(t){this.createdDensity=t,this.nowDrawingDensity=t}setDrawingDensity(t){this.nowDrawingDensity=t}setPosition(t){this.state.position=t}setAngle(t){this.state.angle=t}setArea(t){this.state.area=t}setHardDrawingAngle(t){this.state.hardDrawingAngle=t}setHardAngle(t){this.state.hardAngle=t,this.state.hardDrawingAngle=t}setOrientation(t){this.orientation=t}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class m extends S{constructor(t,e,i){super(t,i),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=e}draw(t){const e=this.render.getContext(),i=this.render.convertToGlobal(this.state.position),s=this.render.getRect().pageWidth,a=this.render.getRect().height;e.save(),e.translate(i.x,i.y),e.beginPath();for(let r of this.state.area)r!==null&&(r=this.render.convertToGlobal(r),e.lineTo(r.x-i.x,r.y-i.y));e.rotate(this.state.angle),e.clip(),this.isLoad?e.drawImage(this.image,0,0,s,a):this.drawLoader(e,{x:0,y:0},s,a),e.restore()}simpleDraw(t){const e=this.render.getRect(),i=this.render.getContext(),s=e.pageWidth,a=e.height,r=t===1?e.left+e.pageWidth:e.left,l=e.top;this.isLoad?i.drawImage(this.image,r,l,s,a):this.drawLoader(i,{x:r,y:l},s,a)}drawLoader(t,e,i,s){t.beginPath(),t.strokeStyle="rgb(200, 200, 200)",t.fillStyle="rgb(255, 255, 255)",t.lineWidth=1,t.rect(e.x+1,e.y+1,i-1,s-1),t.stroke(),t.fill();const a={x:e.x+i/2,y:e.y+s/2};t.beginPath(),t.lineWidth=10,t.arc(a.x,a.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),t.stroke(),t.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class v{constructor(t,e){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=e,this.app=t,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let e=0;e<this.pages.length;e++)this.portraitSpread.push([e]);let t=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([t]),t++);for(let e=t;e<this.pages.length;e+=2)e<this.pages.length-1?this.landscapeSpread.push([e,e+1]):(this.landscapeSpread.push([e]),this.pages[e].setDensity("hard"))}getSpread(){return this.render.getOrientation()==="landscape"?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(t){const e=this.getSpread();for(let i=0;i<e.length;i++)if(t===e[i][0]||t===e[i][1])return i;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(t){if(t>=0&&t<this.pages.length)return this.pages[t];throw new Error("Invalid page number")}nextBy(t){const e=this.pages.indexOf(t);return e<this.pages.length-1?this.pages[e+1]:null}prevBy(t){const e=this.pages.indexOf(t);return e>0?this.pages[e-1]:null}getFlippingPage(t){const e=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return t===0?this.pages[e].newTemporaryCopy():this.pages[e-1];{const i=t===0?this.getSpread()[e+1]:this.getSpread()[e-1];return i.length===1||t===0?this.pages[i[0]]:this.pages[i[1]]}}getBottomPage(t){const e=this.currentSpreadIndex;if(this.render.getOrientation()==="portrait")return t===0?this.pages[e+1]:this.pages[e-1];{const i=t===0?this.getSpread()[e+1]:this.getSpread()[e-1];return i.length===1?this.pages[i[0]]:t===0?this.pages[i[1]]:this.pages[i[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(t=null){if(t===null&&(t=this.currentPageIndex),t<0||t>=this.pages.length)return;const e=this.getSpreadIndexByPage(t);e!==null&&(this.currentSpreadIndex=e,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(t){if(!(t>=0&&t<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=t}showSpread(){const t=this.getSpread()[this.currentSpreadIndex];t.length===2?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(this.pages[t[1]])):this.render.getOrientation()==="landscape"&&t[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[t[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[t[0]])),this.currentPageIndex=t[0],this.app.updatePageIndex(this.currentPageIndex)}}class D extends v{constructor(t,e,i){super(t,e),this.imagesHref=i}load(){for(const t of this.imagesHref){const e=new m(this.render,t,"soft");e.load(),this.pages.push(e)}this.createSpread()}}class g{static GetDistanceBetweenTwoPoint(t,e){return t===null||e===null?1/0:Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static GetSegmentLength(t){return g.GetDistanceBetweenTwoPoint(t[0],t[1])}static GetAngleBetweenTwoLine(t,e){const i=t[0].y-t[1].y,s=e[0].y-e[1].y,a=t[1].x-t[0].x,r=e[1].x-e[0].x;return Math.acos((i*s+a*r)/(Math.sqrt(i*i+a*a)*Math.sqrt(s*s+r*r)))}static PointInRect(t,e){return e===null?null:e.x>=t.left&&e.x<=t.width+t.left&&e.y>=t.top&&e.y<=t.top+t.height?e:null}static GetRotatedPoint(t,e,i){return{x:t.x*Math.cos(i)+t.y*Math.sin(i)+e.x,y:t.y*Math.cos(i)-t.x*Math.sin(i)+e.y}}static LimitPointToCircle(t,e,i){if(g.GetDistanceBetweenTwoPoint(t,i)<=e)return i;const s=t.x,a=t.y,r=i.x,l=i.y;let c=Math.sqrt(Math.pow(e,2)*Math.pow(s-r,2)/(Math.pow(s-r,2)+Math.pow(a-l,2)))+s;i.x<0&&(c*=-1);let f=(c-s)*(a-l)/(s-r)+a;return s-r+a===0&&(f=e),{x:c,y:f}}static GetIntersectBetweenTwoSegment(t,e,i){return g.PointInRect(t,g.GetIntersectBeetwenTwoLine(e,i))}static GetIntersectBeetwenTwoLine(t,e){const i=t[0].y-t[1].y,s=e[0].y-e[1].y,a=t[1].x-t[0].x,r=e[1].x-e[0].x,l=t[0].x*t[1].y-t[1].x*t[0].y,c=e[0].x*e[1].y-e[1].x*e[0].y,f=i*c-s*l,b=a*c-r*l,h=-(l*r-c*a)/(i*r-s*a),p=-(i*c-s*l)/(i*r-s*a);if(isFinite(h)&&isFinite(p))return{x:h,y:p};if(Math.abs(f-b)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(t,e){const i=Math.abs(t.x-e.x),s=Math.abs(t.y-e.y),a=Math.max(i,s),r=[t];function l(c,f,b,h,p){return f>c?c+p*(b/h):f<c?c-p*(b/h):c}for(let c=1;c<=a;c+=1)r.push({x:l(t.x,e.x,i,a,c),y:l(t.y,e.y,s,a,c)});return r}}class N extends S{constructor(t,e,i){super(t,i),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=e,this.element.classList.add("stf__item"),this.element.classList.add("--"+i)}newTemporaryCopy(){return this.nowDrawingDensity==="hard"?this:(this.temporaryCopy===null&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new N(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){this.temporaryCopy!==null&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(t){const e=t||this.nowDrawingDensity,i=this.render.convertToGlobal(this.state.position),s=this.render.getRect().pageWidth,a=this.render.getRect().height;this.element.classList.remove("--simple");const r=`
            display: block;
            z-index: ${this.element.style.zIndex};
            left: 0;
            top: 0;
            width: ${s}px;
            height: ${a}px;
        `;e==="hard"?this.drawHard(r):this.drawSoft(i,r)}drawHard(t=""){const e=this.render.getRect().left+this.render.getRect().width/2,i=this.state.hardDrawingAngle,s=t+`
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                clip-path: none;
                -webkit-clip-path: none;
            `+(this.orientation===0?`transform-origin: ${this.render.getRect().pageWidth}px 0; 
                   transform: translate3d(0, 0, 0) rotateY(${i}deg);`:`transform-origin: 0 0; 
                   transform: translate3d(${e}px, 0, 0) rotateY(${i}deg);`);this.element.style.cssText=s}drawSoft(t,e=""){let i="polygon( ";for(const a of this.state.area)if(a!==null){let r=this.render.getDirection()===1?{x:-a.x+this.state.position.x,y:a.y-this.state.position.y}:{x:a.x-this.state.position.x,y:a.y-this.state.position.y};r=g.GetRotatedPoint(r,{x:0,y:0},this.state.angle),i+=r.x+"px "+r.y+"px, "}i=i.slice(0,-2),i+=")";const s=e+`transform-origin: 0 0; clip-path: ${i}; -webkit-clip-path: ${i};`+(this.render.isSafari()&&this.state.angle===0?`transform: translate(${t.x}px, ${t.y}px);`:`transform: translate3d(${t.x}px, ${t.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=s}simpleDraw(t){const e=this.render.getRect(),i=e.pageWidth,s=e.height,a=t===1?e.left+e.pageWidth:e.left,r=e.top;this.element.classList.add("--simple"),this.element.style.cssText=`
            position: absolute; 
            display: block; 
            height: ${s}px; 
            left: ${a}px; 
            top: ${r}px; 
            width: ${i}px; 
            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(t){super.setOrientation(t),this.element.classList.remove("--left","--right"),this.element.classList.add(t===1?"--right":"--left")}setDrawingDensity(t){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+t),super.setDrawingDensity(t)}}class w extends v{constructor(t,e,i,s){super(t,e),this.element=i,this.pagesElement=s}load(){for(const t of this.pagesElement){const e=new N(this.render,t,t.dataset.density==="hard"?"hard":"soft");e.load(),this.pages.push(e)}this.createSpread()}}class P{constructor(t,e,i,s){this.direction=t,this.corner=e,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(i,10),this.pageHeight=parseInt(s,10)}calc(t){try{return this.position=this.calcAngleAndPosition(t),this.calculateIntersectPoint(this.position),!0}catch{return!1}}getFlippingClipArea(){const t=[];let e=!1;return t.push(this.rect.topLeft),t.push(this.topIntersectPoint),this.sideIntersectPoint===null?e=!0:(t.push(this.sideIntersectPoint),this.bottomIntersectPoint===null&&(e=!1)),t.push(this.bottomIntersectPoint),(e||this.corner==="bottom")&&t.push(this.rect.bottomLeft),t}getBottomClipArea(){const t=[];return t.push(this.topIntersectPoint),this.corner==="top"?t.push({x:this.pageWidth,y:0}):(this.topIntersectPoint!==null&&t.push({x:this.pageWidth,y:0}),t.push({x:this.pageWidth,y:this.pageHeight})),this.sideIntersectPoint!==null?g.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&t.push(this.sideIntersectPoint):this.corner==="top"&&t.push({x:this.pageWidth,y:this.pageHeight}),t.push(this.bottomIntersectPoint),t.push(this.topIntersectPoint),t}getAngle(){return this.direction===0?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return this.direction===0?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return this.direction===1?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return this.corner==="top"?this.topIntersectPoint:this.sideIntersectPoint!==null?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const t=g.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return this.direction===0?t:Math.PI-t}calcAngleAndPosition(t){let e=t;if(this.updateAngleAndGeometry(e),e=this.corner==="top"?this.checkPositionAtCenterLine(e,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(e,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(e.x-this.pageWidth)<1&&Math.abs(e.y)<1)throw new Error("Point is too small");return e}updateAngleAndGeometry(t){this.angle=this.calculateAngle(t),this.rect=this.getPageRect(t)}calculateAngle(t){const e=this.pageWidth-t.x+1,i=this.corner==="bottom"?this.pageHeight-t.y:t.y;let s=2*Math.acos(e/Math.sqrt(i*i+e*e));i<0&&(s=-s);const a=Math.PI-s;if(!isFinite(s)||a>=0&&a<.003)throw new Error("The G point is too small");return this.corner==="bottom"&&(s=-s),s}getPageRect(t){return this.corner==="top"?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],t):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],t)}getRectFromBasePoint(t,e){return{topLeft:this.getRotatedPoint(t[0],e),topRight:this.getRotatedPoint(t[1],e),bottomLeft:this.getRotatedPoint(t[2],e),bottomRight:this.getRotatedPoint(t[3],e)}}getRotatedPoint(t,e){return{x:t.x*Math.cos(this.angle)+t.y*Math.sin(this.angle)+e.x,y:t.y*Math.cos(this.angle)-t.x*Math.sin(this.angle)+e.y}}calculateIntersectPoint(t){const e={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};this.corner==="top"?(this.topIntersectPoint=g.GetIntersectBetweenTwoSegment(e,[t,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=g.GetIntersectBetweenTwoSegment(e,[t,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=g.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=g.GetIntersectBetweenTwoSegment(e,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=g.GetIntersectBetweenTwoSegment(e,[t,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=g.GetIntersectBetweenTwoSegment(e,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(t,e,i){let s=t;const a=g.LimitPointToCircle(e,this.pageWidth,s);s!==a&&(s=a,this.updateAngleAndGeometry(s));const r=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let l=this.rect.bottomRight,c=this.rect.topLeft;if(this.corner==="bottom"&&(l=this.rect.topRight,c=this.rect.bottomLeft),l.x<=0){const f=g.LimitPointToCircle(i,r,c);f!==s&&(s=f,this.updateAngleAndGeometry(s))}return s}getSegmentToShadowLine(){const t=this.getShadowStartPoint();return[t,t!==this.sideIntersectPoint&&this.sideIntersectPoint!==null?this.sideIntersectPoint:this.bottomIntersectPoint]}}class y{constructor(t,e){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=t,this.app=e}fold(t){this.setState("user_fold"),this.calc===null&&this.start(t),this.do(this.render.convertToPage(t))}flip(t){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(t)||(this.calc!==null&&this.render.finishAnimation(),!this.start(t)))return;const e=this.getBoundsRect();this.setState("flipping");const i=e.height/10,s=this.calc.getCorner()==="bottom"?e.height-i:i,a=this.calc.getCorner()==="bottom"?e.height:0;this.calc.calc({x:e.pageWidth-i,y:s}),this.animateFlippingTo({x:e.pageWidth-i,y:s},{x:-e.pageWidth,y:a},!0)}start(t){this.reset();const e=this.render.convertToBook(t),i=this.getBoundsRect(),s=this.getDirectionByPoint(e),a=e.y>=i.height/2?"bottom":"top";if(!this.checkDirection(s))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(s),this.bottomPage=this.app.getPageCollection().getBottomPage(s),this.render.getOrientation()==="landscape")if(s===1){const r=this.app.getPageCollection().nextBy(this.flippingPage);r!==null&&this.flippingPage.getDensity()!==r.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),r.setDrawingDensity("hard"))}else{const r=this.app.getPageCollection().prevBy(this.flippingPage);r!==null&&this.flippingPage.getDensity()!==r.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),r.setDrawingDensity("hard"))}return this.render.setDirection(s),this.calc=new P(s,a,i.pageWidth.toString(10),i.height.toString(10)),!0}catch{return!1}}do(t){if(this.calc!==null&&this.calc.calc(t)){const e=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),this.calc.getDirection()===0?this.flippingPage.setHardAngle(90*(200-2*e)/100):this.flippingPage.setHardAngle(-90*(200-2*e)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),e,this.calc.getDirection())}}flipToPage(t,e){const i=this.app.getPageCollection().getCurrentSpreadIndex(),s=this.app.getPageCollection().getSpreadIndexByPage(t);try{s>i&&(this.app.getPageCollection().setCurrentSpreadIndex(s-1),this.flipNext(e)),s<i&&(this.app.getPageCollection().setCurrentSpreadIndex(s+1),this.flipPrev(e))}catch{}}flipNext(t){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:t==="top"?1:this.render.getRect().height-2})}flipPrev(t){this.flip({x:10,y:t==="top"?1:this.render.getRect().height-2})}stopMove(){if(this.calc===null)return;const t=this.calc.getPosition(),e=this.getBoundsRect(),i=this.calc.getCorner()==="bottom"?e.height:0;t.x<=0?this.animateFlippingTo(t,{x:-e.pageWidth,y:i},!0):this.animateFlippingTo(t,{x:e.pageWidth,y:i},!1)}showCorner(t){if(!this.checkState("read","fold_corner"))return;const e=this.getBoundsRect(),i=e.pageWidth;if(this.isPointOnCorners(t))if(this.calc===null){if(!this.start(t))return;this.setState("fold_corner"),this.calc.calc({x:i-1,y:1});const s=50,a=this.calc.getCorner()==="bottom"?e.height-1:1,r=this.calc.getCorner()==="bottom"?e.height-s:s;this.animateFlippingTo({x:i-1,y:a},{x:i-s,y:r},!1,!1)}else this.do(this.render.convertToPage(t));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(t,e,i,s=!0){const a=g.GetCordsFromTwoPoint(t,e),r=[];for(const c of a)r.push(()=>this.do(c));const l=this.getAnimationDuration(a.length);this.render.startAnimation(r,l,()=>{this.calc&&(i&&(this.calc.getDirection()===1?this.app.turnToPrevPage():this.app.turnToNextPage()),s&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))})}getCalculation(){return this.calc}getState(){return this.state}setState(t){this.state!==t&&(this.app.updateState(t),this.state=t)}getDirectionByPoint(t){const e=this.getBoundsRect();if(this.render.getOrientation()==="portrait"){if(t.x-e.pageWidth<=e.width/5)return 1}else if(t.x<e.width/2)return 1;return 0}getAnimationDuration(t){const e=this.app.getSettings().flippingTime;return t>=1e3?e:t/1e3*e}checkDirection(t){return t===0?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...t){for(const e of t)if(this.state===e)return!0;return!1}isPointOnCorners(t){const e=this.getBoundsRect(),i=e.pageWidth,s=Math.sqrt(Math.pow(i,2)+Math.pow(e.height,2))/5,a=this.render.convertToBook(t);return a.x>0&&a.y>0&&a.x<e.width&&a.y<e.height&&(a.x<s||a.x>e.width-s)&&(a.y<s||a.y>e.height-s)}}class M{constructor(t,e){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=e,this.app=t;const i=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=i.exec(window.navigator.userAgent)!==null}render(t){if(this.animation!==null){const e=Math.round((t-this.animation.startedAt)/this.animation.durationFrame);e<this.animation.frames.length?this.animation.frames[e]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=t,this.drawFrame()}start(){this.update();const t=e=>{this.render(e),requestAnimationFrame(t)};requestAnimationFrame(t)}startAnimation(t,e,i){this.finishAnimation(),this.animation={frames:t,duration:e,durationFrame:e/t.length,onAnimateEnd:i,startedAt:this.timer}}finishAnimation(){this.animation!==null&&(this.animation.frames[this.animation.frames.length-1](),this.animation.onAnimateEnd!==null&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;const t=this.calculateBoundsRect();this.orientation!==t&&(this.orientation=t,this.app.updateOrientation(t))}calculateBoundsRect(){let t="landscape";const e=this.getBlockWidth(),i=e/2,s=this.getBlockHeight()/2,a=this.setting.width/this.setting.height;let r=this.setting.width,l=this.setting.height,c=i-r;return this.setting.size==="stretch"?(e<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(t="portrait"),r=t==="portrait"?this.getBlockWidth():this.getBlockWidth()/2,r>this.setting.maxWidth&&(r=this.setting.maxWidth),l=r/a,l>this.getBlockHeight()&&(l=this.getBlockHeight(),r=l*a),c=t==="portrait"?i-r/2-r:i-r):e<2*r&&this.app.getSettings().usePortrait&&(t="portrait",c=i-r/2-r),this.boundsRect={left:c,top:s-l/2,width:2*r,height:l,pageWidth:r},t}setShadowData(t,e,i,s){if(!this.app.getSettings().drawShadow)return;const a=100*this.getSettings().maxShadowOpacity;this.shadow={pos:t,angle:e,width:3*this.getRect().pageWidth/4*i/100,opacity:(100-i)*a/100/100,direction:s,progress:2*i}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return this.boundsRect===null&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(t){this.pageRect=t}setDirection(t){this.direction=t}setRightPage(t){t!==null&&t.setOrientation(1),this.rightPage=t}setLeftPage(t){t!==null&&t.setOrientation(0),this.leftPage=t}setBottomPage(t){t!==null&&t.setOrientation(this.direction===1?0:1),this.bottomPage=t}setFlippingPage(t){t!==null&&t.setOrientation(this.direction===0&&this.orientation!=="portrait"?0:1),this.flippingPage=t}convertToBook(t){const e=this.getRect();return{x:t.x-e.left,y:t.y-e.top}}isSafari(){return this.safari}convertToPage(t,e){e||(e=this.direction);const i=this.getRect();return{x:e===0?t.x-i.left-i.width/2:i.width/2-t.x+i.left,y:t.y-i.top}}convertToGlobal(t,e){if(e||(e=this.direction),t==null)return null;const i=this.getRect();return{x:e===0?t.x+i.left+i.width/2:i.width/2-t.x+i.left,y:t.y+i.top}}convertRectToGlobal(t,e){return e||(e=this.direction),{topLeft:this.convertToGlobal(t.topLeft,e),topRight:this.convertToGlobal(t.topRight,e),bottomLeft:this.convertToGlobal(t.bottomLeft,e),bottomRight:this.convertToGlobal(t.bottomRight,e)}}}class I extends M{constructor(t,e,i){super(t,e),this.canvas=i,this.ctx=i.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),this.orientation!=="portrait"&&this.leftPage!=null&&this.leftPage.simpleDraw(0),this.rightPage!=null&&this.rightPage.simpleDraw(1),this.bottomPage!=null&&this.bottomPage.draw(),this.drawBookShadow(),this.flippingPage!=null&&this.flippingPage.draw(),this.shadow!=null&&(this.drawOuterShadow(),this.drawInnerShadow());const t=this.getRect();this.orientation==="portrait"&&(this.ctx.beginPath(),this.ctx.rect(t.left+t.pageWidth,t.top,t.width,t.height),this.ctx.clip())}drawBookShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath();const e=t.width/20;this.ctx.rect(t.left,t.top,t.width,t.height);const i={x:t.left+t.width/2-e/2,y:0};this.ctx.translate(i.x,i.y);const s=this.ctx.createLinearGradient(0,0,e,0);s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),s.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),s.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),s.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),s.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=s,this.ctx.fillRect(0,0,e,2*t.height),this.ctx.restore()}drawOuterShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(t.left,t.top,t.width,t.height);const e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const i=this.ctx.createLinearGradient(0,0,this.shadow.width,0);this.shadow.direction===0?(this.ctx.translate(0,-100),i.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),i.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,this.shadow.width,2*t.height),this.ctx.restore()}drawInnerShadow(){const t=this.getRect();this.ctx.save(),this.ctx.beginPath();const e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),i=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(i.topLeft.x,i.topLeft.y),this.ctx.lineTo(i.topRight.x,i.topRight.y),this.ctx.lineTo(i.bottomRight.x,i.bottomRight.y),this.ctx.lineTo(i.bottomLeft.x,i.bottomLeft.y),this.ctx.translate(e.x,e.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const s=3*this.shadow.width/4,a=this.ctx.createLinearGradient(0,0,s,0);this.shadow.direction===0?(this.ctx.translate(-s,-100),a.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),a.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),a.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),a.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),a.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,s,2*t.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class A{constructor(t,e,i){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=a=>{if(this.checkTarget(a.target)){const r=this.getMousePos(a.clientX,a.clientY);this.app.startUserTouch(r),a.preventDefault()}},this.onTouchStart=a=>{if(this.checkTarget(a.target)&&a.changedTouches.length>0){const r=a.changedTouches[0],l=this.getMousePos(r.clientX,r.clientY);this.touchPoint={point:l,time:Date.now()},setTimeout(()=>{this.touchPoint!==null&&this.app.startUserTouch(l)},this.swipeTimeout),this.app.getSettings().mobileScrollSupport||a.preventDefault()}},this.onMouseUp=a=>{const r=this.getMousePos(a.clientX,a.clientY);this.app.userStop(r)},this.onMouseMove=a=>{const r=this.getMousePos(a.clientX,a.clientY);this.app.userMove(r,!1)},this.onTouchMove=a=>{if(a.changedTouches.length>0){const r=a.changedTouches[0],l=this.getMousePos(r.clientX,r.clientY);this.app.getSettings().mobileScrollSupport?(this.touchPoint!==null&&(Math.abs(this.touchPoint.point.x-l.x)>10||this.app.getState()!=="read")&&a.cancelable&&this.app.userMove(l,!0),this.app.getState()!=="read"&&a.preventDefault()):this.app.userMove(l,!0)}},this.onTouchEnd=a=>{if(a.changedTouches.length>0){const r=a.changedTouches[0],l=this.getMousePos(r.clientX,r.clientY);let c=!1;if(this.touchPoint!==null){const f=l.x-this.touchPoint.point.x,b=Math.abs(l.y-this.touchPoint.point.y);Math.abs(f)>this.swipeDistance&&b<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(f>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),c=!0),this.touchPoint=null}this.app.userStop(l,c)}},this.parentElement=t,t.classList.add("stf__parent"),t.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=t.querySelector(".stf__wrapper"),this.app=e;const s=this.app.getSettings().usePortrait?1:2;t.style.minWidth=i.minWidth*s+"px",t.style.minHeight=i.minHeight+"px",i.size==="fixed"&&(t.style.minWidth=i.width*s+"px",t.style.minHeight=i.height+"px"),i.autoSize&&(t.style.width="100%",t.style.maxWidth=2*i.maxWidth+"px"),t.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=i.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(t){this.wrapper.classList.remove("--portrait","--landscape"),t==="portrait"?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(t,e){const i=this.distElement.getBoundingClientRect();return{x:t-i.left,y:e-i.top}}checkTarget(t){return!this.app.getSettings().clickEventForward||!["a","button"].includes(t.tagName.toLowerCase())}}class u extends A{constructor(t,e,i,s){super(t,e,i),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=t.querySelector(".stf__block"),this.items=s;for(const a of s)this.distElement.appendChild(a);this.setHandlers()}clear(){for(const t of this.items)this.parentElement.appendChild(t)}updateItems(t){this.removeHandlers(),this.distElement.innerHTML="";for(const e of t)this.distElement.appendChild(e);this.items=t,this.setHandlers()}update(){this.app.getRender().update()}}class L extends A{constructor(t,e,i){super(t,e,i),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=t.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){const t=getComputedStyle(this.canvas),e=parseInt(t.getPropertyValue("width"),10),i=parseInt(t.getPropertyValue("height"),10);this.canvas.width=e,this.canvas.height=i}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class $ extends M{constructor(t,e,i){super(t,e),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=i,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",`<div class="stf__outerShadow"></div>
             <div class="stf__innerShadow"></div>
             <div class="stf__hardShadow"></div>
             <div class="stf__hardInnerShadow"></div>`),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){const t=this.getRect(),e=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress;let i=(100-e)*(2.5*t.pageWidth)/100+20;i>t.pageWidth&&(i=t.pageWidth);let s=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+5).toString(10)};
            width: ${i}px;
            height: ${t.height}px;
            background: linear-gradient(to right,
                rgba(0, 0, 0, ${this.shadow.opacity*e/100}) 5%,
                rgba(0, 0, 0, 0) 100%);
            left: ${t.left+t.width/2}px;
            transform-origin: 0 0;
        `;s+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=s}drawHardOuterShadow(){const t=this.getRect();let e=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*t.pageWidth)/100+20;e>t.pageWidth&&(e=t.pageWidth);let i=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+4).toString(10)};
            width: ${e}px;
            height: ${t.height}px;
            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);
            left: ${t.left+t.width/2}px;
            transform-origin: 0 0;
        `;i+=this.getDirection()===0&&this.shadow.progress>100||this.getDirection()===1&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=i}drawInnerShadow(){const t=this.getRect(),e=3*this.shadow.width/4,i=this.getDirection()===0?e:0,s=this.getDirection()===0?"to left":"to right",a=this.convertToGlobal(this.shadow.pos),r=this.shadow.angle+3*Math.PI/2,l=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];let c="polygon( ";for(const b of l){let h=this.getDirection()===1?{x:-b.x+this.shadow.pos.x,y:b.y-this.shadow.pos.y}:{x:b.x-this.shadow.pos.x,y:b.y-this.shadow.pos.y};h=g.GetRotatedPoint(h,{x:i,y:100},r),c+=h.x+"px "+h.y+"px, "}c=c.slice(0,-2),c+=")";const f=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${e}px;
            height: ${2*t.height}px;
            background: linear-gradient(${s},
                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,
                rgba(0, 0, 0, 0.05) 15%,
                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,
                rgba(0, 0, 0, 0) 100%);
            transform-origin: ${i}px 100px;
            transform: translate3d(${a.x-i}px, ${a.y-100}px, 0) rotate(${r}rad);
            clip-path: ${c};
            -webkit-clip-path: ${c};
        `;this.innerShadow.style.cssText=f}drawOuterShadow(){const t=this.getRect(),e=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),i=this.shadow.angle+3*Math.PI/2,s=this.getDirection()===1?this.shadow.width:0,a=this.getDirection()===0?"to right":"to left",r=[{x:0,y:0},{x:t.pageWidth,y:0},{x:t.pageWidth,y:t.height},{x:0,y:t.height}];let l="polygon( ";for(const f of r)if(f!==null){let b=this.getDirection()===1?{x:-f.x+this.shadow.pos.x,y:f.y-this.shadow.pos.y}:{x:f.x-this.shadow.pos.x,y:f.y-this.shadow.pos.y};b=g.GetRotatedPoint(b,{x:s,y:100},i),l+=b.x+"px "+b.y+"px, "}l=l.slice(0,-2),l+=")";const c=`
            display: block;
            z-index: ${(this.getSettings().startZIndex+10).toString(10)};
            width: ${this.shadow.width}px;
            height: ${2*t.height}px;
            background: linear-gradient(${a}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));
            transform-origin: ${s}px 100px;
            transform: translate3d(${e.x-s}px, ${e.y-100}px, 0) rotate(${i}rad);
            clip-path: ${l};
            -webkit-clip-path: ${l};
        `;this.outerShadow.style.cssText=c}drawLeftPage(){this.orientation!=="portrait"&&this.leftPage!==null&&(this.direction===1&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){this.rightPage!==null&&(this.direction===0&&this.flippingPage!==null&&this.flippingPage.getDrawingDensity()==="hard"?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(this.bottomPage===null)return;const t=this.flippingPage!=null?this.flippingPage.getDrawingDensity():null;this.orientation==="portrait"&&this.direction===1||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(t))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),this.flippingPage!=null&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),this.shadow!=null&&this.flippingPage!==null&&(this.flippingPage.getDrawingDensity()==="soft"?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(const t of this.app.getPageCollection().getPages())t!==this.leftPage&&t!==this.rightPage&&t!==this.flippingPage&&t!==this.bottomPage&&(t.getElement().style.cssText="display: none"),t.getTemporaryCopy()!==this.flippingPage&&t.hideTemporaryCopy()}update(){super.update(),this.rightPage!==null&&this.rightPage.setOrientation(1),this.leftPage!==null&&this.leftPage.setOrientation(0)}}class B{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(t){const e=this._default;if(Object.assign(e,t),e.size!=="stretch"&&e.size!=="fixed")throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(e.width<=0||e.height<=0)throw new Error("Invalid width or height");if(e.flippingTime<=0)throw new Error("Invalid flipping time");return e.size==="stretch"?(e.minWidth<=0&&(e.minWidth=100),e.maxWidth<e.minWidth&&(e.maxWidth=2e3),e.minHeight<=0&&(e.minHeight=100),e.maxHeight<e.minHeight&&(e.maxHeight=2e3)):(e.minWidth=e.width,e.maxWidth=e.width,e.minHeight=e.height,e.maxHeight=e.height),e}}(function(o,t){t===void 0&&(t={});var e=t.insertAt;if(typeof document<"u"){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",e==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=o:s.appendChild(document.createTextNode(o))}})(`.stf__parent {
  position: relative;
  display: block;
  box-sizing: border-box;
  transform: translateZ(0);

  -ms-touch-action: pan-y;
  touch-action: pan-y;
}

.sft__wrapper {
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

.stf__parent canvas {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}

.stf__block {
  position: absolute;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  perspective: 2000px;
}

.stf__item {
  display: none;
  position: absolute;
  transform-style: preserve-3d;
}

.stf__outerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__innerShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardShadow {
  position: absolute;
  left: 0;
  top: 0;
}

.stf__hardInnerShadow {
  position: absolute;
  left: 0;
  top: 0;
}`),R.PageFlip=class extends class{constructor(){this.events=new Map}on(o,t){return this.events.has(o)?this.events.get(o).push(t):this.events.set(o,[t]),this}off(o){this.events.delete(o)}trigger(o,t,e=null){if(this.events.has(o))for(const i of this.events.get(o))i({data:e,object:t})}}{constructor(o,t){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=new B().getSettings(t),this.block=o}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(o){this.ui=new L(this.block,this,this.setting);const t=this.ui.getCanvas();this.render=new I(this,this.setting,t),this.flipController=new y(this.render,this),this.pages=new D(this,this.render,o),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}loadFromHTML(o){this.ui=new u(this.block,this,this.setting,o),this.render=new $(this,this.setting,this.ui.getDistElement()),this.flipController=new y(this.render,this),this.pages=new w(this,this.render,this.ui.getDistElement(),o),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout(()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})},1)}updateFromImages(o){const t=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new D(this,this.render,o),this.pages.load(),this.pages.show(t),this.trigger("update",this,{page:t,mode:this.render.getOrientation()})}updateFromHtml(o){const t=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new w(this,this.render,this.ui.getDistElement(),o),this.pages.load(),this.ui.updateItems(o),this.render.reload(),this.pages.show(t),this.trigger("update",this,{page:t,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(o){this.pages.show(o)}flipNext(o="top"){this.flipController.flipNext(o)}flipPrev(o="top"){this.flipController.flipPrev(o)}flip(o,t="top"){this.flipController.flipToPage(o,t)}updateState(o){this.trigger("changeState",this,o)}updatePageIndex(o){this.trigger("flip",this,o)}updateOrientation(o){this.ui.setOrientationStyle(o),this.update(),this.trigger("changeOrientation",this,o)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(o){return this.pages.getPage(o)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(o){this.mousePosition=o,this.isUserTouch=!0,this.isUserMove=!1}userMove(o,t){this.isUserTouch||t||!this.setting.showPageCorners?this.isUserTouch&&g.GetDistanceBetweenTwoPoint(this.mousePosition,o)>5&&(this.isUserMove=!0,this.flipController.fold(o)):this.flipController.showCorner(o)}userStop(o,t=!1){this.isUserTouch&&(this.isUserTouch=!1,t||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(o)))}},Object.defineProperty(R,"__esModule",{value:!0})}))})(H,H.exports)),H.exports}var pt=gt();const ut=E.forwardRef((d,k)=>{const R=x.useRef(null),S=x.useRef([]),m=x.useRef(),[v,D]=x.useState([]);x.useImperativeHandle(k,()=>({pageFlip:()=>m.current}));const g=x.useCallback(()=>{m.current&&m.current.clear()},[]),N=x.useCallback(()=>{const w=m.current;w&&(w.off("flip"),w.off("changeOrientation"),w.off("changeState"),w.off("init"),w.off("update"))},[]);return x.useEffect(()=>{if(S.current=[],d.children){const w=E.Children.map(d.children,P=>E.cloneElement(P,{ref:y=>{y&&S.current.push(y)}}));(!d.renderOnlyPageLengthChange||v.length!==w.length)&&(w.length<v.length&&g(),D(w))}},[d.children]),x.useEffect(()=>{const w=()=>{const P=m.current;P&&(d.onFlip&&P.on("flip",y=>d.onFlip(y)),d.onChangeOrientation&&P.on("changeOrientation",y=>d.onChangeOrientation(y)),d.onChangeState&&P.on("changeState",y=>d.onChangeState(y)),d.onInit&&P.on("init",y=>d.onInit(y)),d.onUpdate&&P.on("update",y=>d.onUpdate(y)))};v.length>0&&S.current.length>0&&(N(),R.current&&!m.current&&(m.current=new pt.PageFlip(R.current,d)),m.current.getFlipController()?m.current.updateFromHtml(S.current):m.current.loadFromHTML(S.current),w())},[v]),E.createElement("div",{ref:R,className:d.className,style:d.style},v)}),xt=E.memo(ut);K.workerSrc=`//unpkg.com/pdfjs-dist@${J}/build/pdf.worker.min.mjs`;const _=400,X=E.forwardRef((d,k)=>n.jsx("div",{className:"demoPage bg-white overflow-hidden flex items-center justify-center shadow-inner",ref:k,style:{width:"100%",height:"100%"},children:d.children}));X.displayName="PageWrapper";const mt=E.forwardRef((d,k)=>n.jsx("div",{className:"demoPage",ref:k,"data-density":"hard",children:n.jsxs("div",{className:"relative h-full w-full bg-primary shadow-2xl overflow-hidden rounded-r-sm",children:[d.children,n.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-white/20 via-transparent to-black/10 pointer-events-none"})]})}));mt.displayName="CoverWrapper";const ft=({pdfUrl:d,title:k,coverImage:R,onClose:S,language:m="ar"})=>{const v=x.useRef(null),D=x.useRef(null),[g,N]=x.useState(0),[w,P]=x.useState(!0),[y,M]=x.useState(!1),[I,A]=x.useState(!1),[u,L]=x.useState(0);x.useEffect(()=>{const i=()=>{M(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",i),()=>document.removeEventListener("fullscreenchange",i)},[]);const $=x.useCallback(()=>{var i;document.fullscreenElement?document.exitFullscreen():(i=D.current)==null||i.requestFullscreen().catch(s=>{console.error(`Error attempting to enable fullscreen: ${s.message}`)})},[]);function B({numPages:i}){N(i),P(!1)}const o=x.useCallback(()=>{var i,s;(s=(i=v.current)==null?void 0:i.pageFlip())==null||s.flipNext()},[]),t=x.useCallback(()=>{var i,s;(s=(i=v.current)==null?void 0:i.pageFlip())==null||s.flipPrev()},[]),e=x.useCallback(i=>{if(i&&typeof i.data=="number"&&L(i.data),!I){const s=new Audio("/sounds/page-flip.mp3");s.volume=.5,s.play().catch(a=>console.warn("Sound file not found or blocked:",a))}},[I]);return n.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-sm flex items-center justify-center p-4 transition-all duration-300",children:n.jsxs("div",{ref:D,className:`bg-gray-900 rounded-2xl overflow-hidden shadow-2xl flex flex-col transition-all duration-500 ease-in-out border border-gray-700
                ${y?"fixed inset-0 w-full h-full rounded-none":"w-full max-w-6xl h-[90vh] relative"}`,children:[n.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-800 border-b border-gray-700 z-20",children:[n.jsx("h2",{className:"text-white font-bold text-lg truncate px-2",children:k}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>{const i=document.createElement("a");i.href=d,i.download=`${k}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i)},className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",title:"Download PDF",children:n.jsx(F,{size:20})}),n.jsx("button",{onClick:$,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:y?n.jsx(et,{size:20}):n.jsx(it,{size:20})}),n.jsx("button",{onClick:()=>A(!I),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700 rounded-lg transition-colors",children:I?n.jsx(st,{size:20}):n.jsx(nt,{size:20})}),n.jsx("button",{onClick:S,className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-colors",children:n.jsx(Y,{size:20})})]})]}),n.jsxs("div",{className:"flex-1 relative flex items-center justify-center bg-[#1a1a1a] overflow-hidden",style:{perspective:"1500px"},children:[w&&n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white z-50 bg-[#1a1a1a]",children:[n.jsx(O,{size:48,className:"animate-spin text-primary mb-4"}),n.jsx("p",{className:"text-gray-400",children:"جاري تحميل القصة..."})]}),!w&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:t,className:"absolute left-4 z-30 p-3 bg-black/30 hover:bg-primary text-white rounded-full backdrop-blur transition-all hidden md:flex items-center justify-center",children:n.jsx(at,{size:28})}),n.jsx("button",{onClick:o,className:"absolute right-4 z-30 p-3 bg-black/30 hover:bg-primary text-white rounded-full backdrop-blur transition-all hidden md:flex items-center justify-center",children:n.jsx(rt,{size:28})})]}),n.jsx(Z,{file:d,onLoadSuccess:B,loading:null,className:"flex justify-center items-center h-full",options:{cMapUrl:"cmaps/",cMapPacked:!0,disableRange:!0,disableStream:!0},children:g>0&&n.jsx(xt,{width:_,height:_*1.4,size:"fixed",minWidth:300,maxWidth:1200,maxHeight:1600,maxShadowOpacity:.5,showCover:!0,mobileScrollSupport:!0,className:"shadow-2xl",ref:v,style:{margin:"0 auto",transform:(()=>{let i="";return u===0?i+="translateX(-25%) rotateY(-5deg)":u===g-1&&g%2===0&&(i+="translateX(25%) rotateY(5deg)"),i})(),transition:"transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)",transformStyle:"preserve-3d"},autoSize:!0,clickEventForward:!0,useMouseEvents:!0,swipeDistance:30,showPageCorners:!0,disableFlipByClick:!1,usePortrait:!1,onFlip:e,children:Array.from(new Array(g),(i,s)=>n.jsx(X,{children:n.jsx(V,{pageNumber:s+1,width:_,renderAnnotationLayer:!1,renderTextLayer:!1,className:"object-contain",loading:n.jsx("div",{className:"w-full h-full flex items-center justify-center",children:n.jsx(O,{className:"animate-spin text-gray-300"})})})},`page_${s+1}`))})})]})]})})},St=({lang:d,stories:k,categories:R,onUpdateStats:S})=>{const m=tt[d].library,[v,D]=x.useState("all"),[g,N]=x.useState("all"),[w,P]=x.useState("all"),[y,M]=x.useState("all"),[I,A]=x.useState(null),[u,L]=x.useState(null),[$,B]=x.useState(!1),o=d==="ar",t=u?`${u.title[d]||u.title.en} | Jeen Arabi`:`${m.title} | Jeen Arabi`,e=u?u.description[d]||u.description.en||"Interactive story for kids":"Discover a world of bilingual stories for children. Read, learn, and grow with Jeen Arabi.",i=Array.from(new Set(k.flatMap(h=>h.tags||[]))),s=k.filter(h=>{var j;const p=v==="all"||h.ageGroup===v;let C=!0;if(g!=="all"){const z=g;C=(j=h.availableLanguages)==null?void 0:j.includes(z)}const W=w==="all"||(h.categories||[]).includes(w),T=y==="all"||(h.tags||[]).includes(y);return p&&C&&W&&T}),a=(h,p)=>{h.stopPropagation(),S(p.id,"download");const C=document.createElement("a");C.href=p.pdfUrl,C.download=`${p.title.en||"story"}.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C)},r=(h,p)=>{h.stopPropagation(),S(p.id,"view"),A(p),L(null)},l=(h,p)=>{h.stopPropagation(),M(p)},c=(h,p)=>{h.stopPropagation(),P(p)},f=h=>{const p=R.find(C=>C.id===h);return p&&(p.name[d]||p.name.en)||"Unknown"},b=({value:h,onChange:p,options:C,label:W})=>n.jsxs("div",{className:"relative group bg-white dark:bg-dark-card border border-gray-200 dark:border-gray-700 rounded-xl hover:border-primary/50 transition-colors shadow-sm h-14 flex items-center px-4 cursor-pointer",children:[n.jsxs("span",{className:"text-xs font-bold uppercase tracking-wider text-gray-400 whitespace-nowrap",children:[W,":"]}),n.jsx("select",{value:h,onChange:T=>p(T.target.value),className:`w-full h-full bg-transparent border-none text-gray-900 dark:text-white font-bold text-sm focus:ring-0 cursor-pointer pl-2 pr-8 outline-none appearance-none ${o?"text-right":"text-left"}`,children:C.map(T=>n.jsx("option",{value:T.val,className:"text-gray-900 dark:text-white bg-white dark:bg-dark-card",children:T.label},T.val))}),n.jsx("div",{className:`absolute inset-y-0 flex items-center pointer-events-none text-gray-400 group-hover:text-primary transition-colors ${o?"left-3":"right-3"}`,children:n.jsx(dt,{size:18})})]});return n.jsxs("div",{className:"min-h-screen bg-background dark:bg-dark-bg py-12 px-6 sm:px-8 lg:px-12 relative transition-colors duration-300",children:[n.jsxs(Q,{children:[n.jsx("title",{children:t}),n.jsx("meta",{name:"description",content:e}),n.jsx("meta",{property:"og:title",content:t}),n.jsx("meta",{property:"og:description",content:e}),u&&n.jsx("meta",{property:"og:image",content:u.coverImage})]}),n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsxs("div",{className:`flex flex-col md:flex-row justify-between items-center mb-12 gap-4 ${o?"md:flex-row-reverse":""}`,children:[n.jsx("h1",{className:`text-4xl md:text-5xl font-bold text-gray-900 dark:text-white animate-slide-up ${o?"font-arabic":""}`,children:m.title}),n.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:[s.length," Stories Available"]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-12 animate-fade-in",style:{animationDelay:"0.1s"},children:[n.jsx(b,{label:o?"العمر":"Age",value:v,onChange:D,options:[{val:"all",label:m.all},{val:"3-5",label:"3-5"},{val:"6-8",label:"6-8"},{val:"9-12",label:"9-12"}]}),n.jsx(b,{label:o?"اللغة":"Language",value:g,onChange:N,options:[{val:"all",label:m.all},{val:"ar",label:"Arabic"},{val:"en",label:"English"},{val:"fr",label:"French"}]}),n.jsx(b,{label:o?"التصنيف":"Category",value:w,onChange:P,options:[{val:"all",label:m.all},...R.map(h=>({val:h.id,label:h.name[d]||h.name.en||"Unknown"}))]}),n.jsx(b,{label:o?"الموضوع":"Topic",value:y,onChange:M,options:[{val:"all",label:m.all},...i.map(h=>({val:h,label:h}))]})]}),k.length===0?n.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-fade-in",children:[n.jsxs("div",{className:"relative mb-6",children:[n.jsx("div",{className:"absolute inset-0 bg-primary/20 blur-3xl rounded-full"}),n.jsx(ot,{size:80,className:"text-primary relative z-10 animate-bounce"})]}),n.jsx("h2",{className:`text-3xl font-bold text-gray-900 dark:text-white mb-4 ${o?"font-arabic":""}`,children:o?"انتظروا المرح قريباً!":"The Magic is Coming Soon!"}),n.jsx("p",{className:`text-xl text-gray-500 dark:text-gray-400 max-w-lg mx-auto leading-relaxed ${o?"font-arabic":""}`,children:o?"نحن نجهز مجموعة رائعة من القصص الممتعة. عد إلينا قريباً لتكتشف عالماً من الخيال!":"We are preparing a wonderful collection of stories. Check back soon to discover a world of imagination!"})]}):s.length===0?n.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center animate-fade-in",children:[n.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 p-6 rounded-full mb-6",children:n.jsx(ht,{size:48,className:"text-gray-400 dark:text-gray-500"})}),n.jsx("h3",{className:`text-2xl font-bold text-gray-900 dark:text-white mb-2 ${o?"font-arabic":""}`,children:o?"لم يتم العثور على قصص":"No Stories Found"}),n.jsx("p",{className:`text-gray-500 dark:text-gray-400 mb-6 ${o?"font-arabic":""}`,children:o?"جرب تغيير خيارات البحث أو تصفح كل القصص.":"Try adjusting your filters or browse all stories."}),n.jsx("button",{onClick:()=>{D("all"),N("all"),P("all"),M("all")},className:"px-6 py-2 bg-primary text-white rounded-xl font-bold hover:bg-primary-dark transition-colors shadow-lg shadow-primary/20",children:o?"عرض كل القصص":"View All Stories"})]}):n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:s.map((h,p)=>{const C=h.title[d]||h.title.en||Object.values(h.title)[0]||"Untitled",W=h.description[d]||h.description.en||Object.values(h.description)[0]||"",T=d==="ar"&&h.title[d]||!h.title[d]&&h.title.ar;return n.jsxs("article",{onClick:()=>L(h),className:"group card-hover bg-white dark:bg-dark-card rounded-3xl shadow-lg shadow-gray-200/50 dark:shadow-black/30 border border-gray-100 dark:border-gray-700 overflow-hidden flex flex-col animate-slide-up relative cursor-pointer",style:{animationDelay:`${.1+p*.05}s`},children:[n.jsxs("div",{className:"relative h-96 overflow-hidden",children:[n.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent z-10 opacity-60"}),n.jsx("img",{src:h.coverImage,alt:C,loading:"lazy",className:"w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"}),n.jsx("div",{className:"absolute top-3 right-3 z-20 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md px-3 py-1 rounded-full text-xs font-bold text-gray-800 dark:text-gray-200 shadow-sm border border-white/20",children:h.ageGroup}),n.jsxs("div",{className:"absolute bottom-0 left-0 right-0 z-20 p-3 flex justify-around text-white text-xs font-medium border-t border-white/10 bg-black/40 backdrop-blur-sm",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(G,{size:14,className:"text-blue-300"}),n.jsx("span",{children:h.views.toLocaleString()})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(F,{size:14,className:"text-green-300"}),n.jsx("span",{children:h.downloads.toLocaleString()})]})]})]}),n.jsxs("div",{className:`p-6 flex-1 flex flex-col ${T?"text-right":"text-left"}`,children:[n.jsxs("div",{className:`flex flex-wrap gap-2 mb-3 ${T?"justify-end":"justify-start"}`,children:[(h.categories||[]).map(j=>n.jsx("button",{onClick:z=>c(z,j),className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-[10px] uppercase tracking-wide font-bold bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors z-10",children:f(j)},j)),(h.tags||[]).slice(0,2).map(j=>n.jsx("button",{onClick:z=>l(z,j),className:"inline-flex items-center px-2.5 py-0.5 rounded-md text-[10px] uppercase tracking-wide font-bold bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors z-10",children:j},j))]}),n.jsx("h2",{className:`text-xl font-bold text-gray-900 dark:text-white mb-2 line-clamp-2 group-hover:text-primary transition-colors ${T?"font-arabic":"font-sans"}`,children:C}),n.jsx("p",{className:`text-gray-500 dark:text-gray-400 text-sm mb-6 flex-1 line-clamp-3 leading-relaxed ${T?"font-arabic":"font-sans"}`,children:W}),n.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-auto",children:[n.jsxs("button",{onClick:j=>r(j,h),className:"flex items-center justify-center gap-2 py-3 bg-primary hover:bg-primary-dark text-white rounded-xl transition-all shadow-lg shadow-primary/20 hover:shadow-primary/40 font-bold text-sm",children:[n.jsx(U,{size:16}),m.read]}),n.jsxs("button",{onClick:j=>a(j,h),className:"flex items-center justify-center gap-2 py-3 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-xl transition-colors font-bold text-sm",children:[n.jsx(F,{size:16}),m.download]})]})]})]},h.id)})})]}),u&&n.jsx("div",{className:"fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",onClick:()=>L(null),children:n.jsxs("div",{className:"bg-white dark:bg-dark-card w-full max-w-4xl rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row max-h-[90vh] animate-slide-up",onClick:h=>h.stopPropagation(),children:[n.jsx("div",{className:"w-full md:w-2/5 h-64 md:h-auto relative",children:n.jsx("img",{src:u.coverImage,alt:"Cover",className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"flex-1 p-8 flex flex-col overflow-y-auto",children:[n.jsxs("div",{className:"flex justify-between items-start mb-6",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[(u.categories||[]).map(h=>n.jsx("button",{onClick:p=>{c(p,h),L(null)},className:"px-3 py-1 rounded-full text-xs font-bold bg-primary/10 text-primary uppercase tracking-wider hover:bg-primary hover:text-white transition-colors",children:f(h)},h)),(u.tags||[]).map(h=>n.jsx("button",{onClick:p=>{l(p,h),L(null)},className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 uppercase tracking-wider hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:h},h))]}),n.jsx("h2",{className:`text-3xl font-bold text-gray-900 dark:text-white leading-tight ${d==="ar"&&u.title[d]?"font-arabic text-right":""}`,children:u.title[d]||u.title.en})]}),n.jsx("button",{onClick:()=>L(null),className:"text-gray-400 hover:text-red-500",children:n.jsx(Y,{size:24})})]}),n.jsx("div",{className:"flex items-center gap-6 mb-8 text-sm text-gray-500 dark:text-gray-400 border-b border-gray-100 dark:border-gray-700 pb-6",children:n.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500 dark:text-gray-400 mb-6",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(F,{size:16})," ",m.downloads,": ",n.jsx("span",{className:"font-bold text-gray-900 dark:text-white",children:u.downloads})]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(G,{size:16})," ",m.views,": ",n.jsx("span",{className:"font-bold text-gray-900 dark:text-white",children:u.views})]}),n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(lt,{size:16})," ",m.age,": ",n.jsx("span",{className:"font-bold text-gray-900 dark:text-white",children:u.ageGroup})]})]})}),n.jsx("div",{className:"prose dark:prose-invert max-w-none mb-8",children:n.jsx("p",{className:`text-lg leading-relaxed text-gray-600 dark:text-gray-300 ${d==="ar"&&u.description[d]?"font-arabic text-right":""}`,children:u.description[d]||u.description.en})}),n.jsxs("div",{className:"mt-auto grid grid-cols-2 gap-4",children:[n.jsxs("button",{onClick:h=>r(h,u),className:"flex items-center justify-center gap-2 py-4 bg-primary hover:bg-primary-dark text-white rounded-xl shadow-xl shadow-primary/20 hover:shadow-primary/40 font-bold text-lg",children:[n.jsx(U,{size:20}),m.read]}),n.jsxs("button",{onClick:h=>a(h,u),className:"flex items-center justify-center gap-2 py-4 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-white rounded-xl font-bold text-lg transition-colors",children:[n.jsx(F,{size:20}),m.download]})]})]})]})}),I&&n.jsx(ft,{pdfUrl:I.pdfUrl,title:I.title[d]||I.title.en||"Story",coverImage:I.coverImage,onClose:()=>{document.exitFullscreen&&document.fullscreenElement&&document.exitFullscreen(),A(null)}})]})};export{St as Library};
