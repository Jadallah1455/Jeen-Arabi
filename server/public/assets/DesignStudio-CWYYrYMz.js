import{j as n,E as Ce,h as Ee}from"./pdf-D5M-G2vY.js";import{r as g}from"./vendor-CvWOdSKG.js";import{a as Ie,T as Te,S as pe}from"./index-BxkEYnYd.js";import{P as me,D as De,T as Me,W as $e,k as Le,C as Re,o as ve,p as Fe,X as xe,q as ze,r as We,U as Oe,s as Ae,t as Ge,z as de}from"./ui-DVHeSrky.js";import"./utils-B9ygI19o.js";const Ue=async(c,u,i)=>{try{return(await Ie.post("/ai/generate-story",{title:c,elements:u,language:i})).data.story||"Could not generate story."}catch(f){return console.error("Gemini API Error:",f),"Sorry, I couldn't write the story right now. Please try again later!"}};function ye(c,u,i,f,d,v,w){try{var N=c[v](w),p=N.value}catch(C){i(C);return}N.done?u(p):Promise.resolve(p).then(f,d)}function Be(c){return function(){var u=this,i=arguments;return new Promise(function(f,d){var v=c.apply(u,i);function w(p){ye(v,f,d,w,N,"next",p)}function N(p){ye(v,f,d,w,N,"throw",p)}w(void 0)})}}function ie(){return ie=Object.assign||function(c){for(var u=1;u<arguments.length;u++){var i=arguments[u];for(var f in i)Object.prototype.hasOwnProperty.call(i,f)&&(c[f]=i[f])}return c},ie.apply(this,arguments)}var Se={exports:{}};(function(c){var u=(function(i){var f=Object.prototype,d=f.hasOwnProperty,v,w=typeof Symbol=="function"?Symbol:{},N=w.iterator||"@@iterator",p=w.asyncIterator||"@@asyncIterator",C=w.toStringTag||"@@toStringTag";function b(t,e,o){return Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{b({},"")}catch{b=function(e,o,s){return e[o]=s}}function M(t,e,o,s){var a=e&&e.prototype instanceof A?e:A,m=Object.create(a.prototype),x=new J(s||[]);return m._invoke=ae(t,o,x),m}i.wrap=M;function F(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(s){return{type:"throw",arg:s}}}var O="suspendedStart",Y="suspendedYield",z="executing",W="completed",T={};function A(){}function q(){}function D(){}var V={};b(V,N,function(){return this});var $=Object.getPrototypeOf,L=$&&$($(H([])));L&&L!==f&&d.call(L,N)&&(V=L);var E=D.prototype=A.prototype=Object.create(V);q.prototype=D,b(E,"constructor",D),b(D,"constructor",q),q.displayName=b(D,C,"GeneratorFunction");function Z(t){["next","throw","return"].forEach(function(e){b(t,e,function(o){return this._invoke(e,o)})})}i.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===q||(e.displayName||e.name)==="GeneratorFunction":!1},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,D):(t.__proto__=D,b(t,C,"GeneratorFunction")),t.prototype=Object.create(E),t},i.awrap=function(t){return{__await:t}};function X(t,e){function o(m,x,r,l){var h=F(t[m],t,x);if(h.type==="throw")l(h.arg);else{var k=h.arg,S=k.value;return S&&typeof S=="object"&&d.call(S,"__await")?e.resolve(S.__await).then(function(_){o("next",_,r,l)},function(_){o("throw",_,r,l)}):e.resolve(S).then(function(_){k.value=_,r(k)},function(_){return o("throw",_,r,l)})}}var s;function a(m,x){function r(){return new e(function(l,h){o(m,x,l,h)})}return s=s?s.then(r,r):r()}this._invoke=a}Z(X.prototype),b(X.prototype,p,function(){return this}),i.AsyncIterator=X,i.async=function(t,e,o,s,a){a===void 0&&(a=Promise);var m=new X(M(t,e,o,s),a);return i.isGeneratorFunction(e)?m:m.next().then(function(x){return x.done?x.value:m.next()})};function ae(t,e,o){var s=O;return function(m,x){if(s===z)throw new Error("Generator is already running");if(s===W){if(m==="throw")throw x;return Q()}for(o.method=m,o.arg=x;;){var r=o.delegate;if(r){var l=G(r,o);if(l){if(l===T)continue;return l}}if(o.method==="next")o.sent=o._sent=o.arg;else if(o.method==="throw"){if(s===O)throw s=W,o.arg;o.dispatchException(o.arg)}else o.method==="return"&&o.abrupt("return",o.arg);s=z;var h=F(t,e,o);if(h.type==="normal"){if(s=o.done?W:Y,h.arg===T)continue;return{value:h.arg,done:o.done}}else h.type==="throw"&&(s=W,o.method="throw",o.arg=h.arg)}}}function G(t,e){var o=t.iterator[e.method];if(o===v){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=v,G(t,e),e.method==="throw"))return T;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var s=F(o,t.iterator,e.arg);if(s.type==="throw")return e.method="throw",e.arg=s.arg,e.delegate=null,T;var a=s.arg;if(!a)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,T;if(a.done)e[t.resultName]=a.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=v);else return a;return e.delegate=null,T}Z(E),b(E,C,"Generator"),b(E,N,function(){return this}),b(E,"toString",function(){return"[object Generator]"});function ee(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function K(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function J(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(ee,this),this.reset(!0)}i.keys=function(t){var e=[];for(var o in t)e.push(o);return e.reverse(),function s(){for(;e.length;){var a=e.pop();if(a in t)return s.value=a,s.done=!1,s}return s.done=!0,s}};function H(t){if(t){var e=t[N];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var o=-1,s=function a(){for(;++o<t.length;)if(d.call(t,o))return a.value=t[o],a.done=!1,a;return a.value=v,a.done=!0,a};return s.next=s}}return{next:Q}}i.values=H;function Q(){return{value:v,done:!0}}return J.prototype={constructor:J,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(K),!t)for(var e in this)e.charAt(0)==="t"&&d.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function o(l,h){return m.type="throw",m.arg=t,e.next=l,h&&(e.method="next",e.arg=v),!!h}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],m=a.completion;if(a.tryLoc==="root")return o("end");if(a.tryLoc<=this.prev){var x=d.call(a,"catchLoc"),r=d.call(a,"finallyLoc");if(x&&r){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(x){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else if(r){if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o];if(s.tryLoc<=this.prev&&d.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var a=s;break}}a&&(t==="break"||t==="continue")&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var m=a?a.completion:{};return m.type=t,m.arg=e,a?(this.method="next",this.next=a.finallyLoc,T):this.complete(m)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),T},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),K(o),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var s=o.completion;if(s.type==="throw"){var a=s.arg;K(o)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,o){return this.delegate={iterator:H(t),resultName:e,nextLoc:o},this.method==="next"&&(this.arg=v),T}},i})(c.exports);try{regeneratorRuntime=u}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=u:Function("r","regeneratorRuntime = r")(u)}})(Se);var be=Se.exports,je=function(u){var i=u.paths,f=u.id,d=u.strokeWidth,v=u.strokeColor,w=u.command,N=w===void 0?Ne:w;if(i.length===1){var p=i[0],C=p.x,b=p.y,M=d/2;return g.createElement("circle",{key:f,id:f,cx:C,cy:b,r:M,stroke:v,fill:v})}var F=i.reduce(function(O,Y,z,W){return z===0?"M "+Y.x+","+Y.y:O+" "+N(Y,z,W)},"");return g.createElement("path",{key:f,id:f,d:F,fill:"none",strokeLinecap:"round",stroke:v,strokeWidth:d})},Ye=function(u,i){var f=i.x-u.x,d=i.y-u.y;return{length:Math.sqrt(Math.pow(f,2)+Math.pow(d,2)),angle:Math.atan2(d,f)}},he=function(u){var i=u.current,f=u.next,d=u.previous,v=u.reverse,w=d||i,N=f||i,p=.2,C=Ye(w,N),b=C.angle+(v?Math.PI:0),M=C.length*p,F=i.x+Math.cos(b)*M,O=i.y+Math.sin(b)*M;return[F,O]},Ne=function(u,i,f){var d=null,v=null;switch(i){case 0:var w=he({current:u});d=w[0],v=w[1];break;case 1:var N=he({current:f[i-1],next:u});d=N[0],v=N[1];break;default:var p=he({current:f[i-1],previous:f[i-2],next:u});d=p[0],v=p[1];break}var C=he({current:u,previous:f[i-1],next:f[i+1],reverse:!0}),b=C[0],M=C[1];return"C "+d+","+v+" "+b+","+M+" "+u.x+", "+u.y},Xe=function(u){var i=u.id,f=u.paths;return g.createElement(g.Fragment,null,f.map(function(d,v){return g.createElement(je,{key:i+"__"+v,paths:d.paths,id:i+"__"+v,strokeWidth:d.strokeWidth,strokeColor:d.strokeColor,command:Ne})}))},we=function(u){return new Promise(function(i,f){var d=new Image;d.addEventListener("load",function(){d.width>0&&i(d),f("Image not found")}),d.addEventListener("error",function(v){return f(v)}),d.src=u,d.setAttribute("crossorigin","anonymous")})};function ke(c){var u,i=(u=c.firstChild)==null?void 0:u.cloneNode(!0),f=c.offsetWidth,d=c.offsetHeight;return i.setAttribute("viewBox","0 0 "+f+" "+d),i.setAttribute("width",f.toString()),i.setAttribute("height",d.toString()),{svgCanvas:i,width:f,height:d}}var He=g.forwardRef(function(c,u){var i=c.paths,f=c.isDrawing,d=c.onPointerDown,v=c.onPointerMove,w=c.onPointerUp,N=c.id,p=N===void 0?"react-sketch-canvas":N,C=c.width,b=C===void 0?"100%":C,M=c.height,F=M===void 0?"100%":M,O=c.className,Y=O===void 0?"react-sketch-canvas":O,z=c.canvasColor,W=z===void 0?"red":z,T=c.backgroundImage,A=T===void 0?"":T,q=c.exportWithBackgroundImage,D=q===void 0?!1:q,V=c.preserveBackgroundImageAspectRatio,$=V===void 0?"none":V,L=c.allowOnlyPointerType,E=L===void 0?"all":L,Z=c.style,X=Z===void 0?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:Z,ae=c.svgStyle,G=ae===void 0?{}:ae,ee=g.useRef(null),K=function(a){var m,x,r,l=(m=ee.current)==null?void 0:m.getBoundingClientRect(),h=(x=window.scrollX)!=null?x:0,k=(r=window.scrollY)!=null?r:0;if(!l)return{x:0,y:0};var S={x:a.pageX-l.left-h,y:a.pageY-l.top-k};return S},J=function(a){if(!(E!=="all"&&a.pointerType!==E)&&!(a.pointerType==="mouse"&&a.button!==0)){var m=K(a);d(m)}},H=function(a){if(f&&!(E!=="all"&&a.pointerType!==E)){var m=K(a);v(m)}},Q=function(a){a.pointerType==="mouse"&&a.button!==0||E!=="all"&&a.pointerType!==E||w()};g.useImperativeHandle(u,function(){return{exportImage:function(a){return new Promise((function(){var m=Be(be.mark(function x(r,l){var h,k,S,_,U,ne,oe,B;return be.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(P.prev=0,h=ee.current,h){P.next=4;break}throw Error("Canvas not rendered yet");case 4:return k=ke(h),S=k.svgCanvas,_=k.width,U=k.height,ne="data:image/svg+xml;base64,"+btoa(S.outerHTML),P.next=8,we(ne);case 8:if(P.t0=P.sent,oe=[P.t0],!D){P.next=21;break}return P.prev=11,P.next=14,we(A);case 14:B=P.sent,oe.push(B),P.next=21;break;case 18:P.prev=18,P.t1=P.catch(11),console.warn("exportWithBackgroundImage props is set without a valid background image URL. This option is ignored");case 21:Promise.all(oe).then(function(ce){var le=document.createElement("canvas");le.setAttribute("width",_.toString()),le.setAttribute("height",U.toString());var ue=le.getContext("2d");if(!ue)throw Error("Canvas not rendered yet");ce.reverse().forEach(function(I){ue.drawImage(I,0,0)}),r(le.toDataURL("image/"+a))}).catch(function(ce){throw ce}),P.next=27;break;case 24:P.prev=24,P.t2=P.catch(0),l(P.t2);case 27:case"end":return P.stop()}},x,null,[[0,24],[11,18]])}));return function(x,r){return m.apply(this,arguments)}})())},exportSvg:function(){return new Promise(function(a,m){try{var x,r=(x=ee.current)!=null?x:null;if(r!==null){var l,h,k=ke(r),S=k.svgCanvas;if(D){a(S.outerHTML);return}(l=S.querySelector("#"+p+"__background"))==null||l.remove(),(h=S.querySelector("#"+p+"__canvas-background"))==null||h.setAttribute("fill",W),a(S.outerHTML)}m(new Error("Canvas not loaded"))}catch(_){m(_)}})}}}),g.useEffect(function(){return document.addEventListener("pointerup",Q),function(){document.removeEventListener("pointerup",Q)}},[Q]);var t=i.filter(function(s){return!s.drawMode}),e=0,o=i.reduce(function(s,a){return a.drawMode?(s[e]===void 0&&(s[e]=[]),s[e].push(a),s):(e+=1,s)},[[]]);return g.createElement("div",{role:"presentation",ref:ee,className:Y,style:ie({touchAction:"none",width:b,height:F},X),"touch-action":"none",onPointerDown:J,onPointerMove:H,onPointerUp:Q},g.createElement("svg",{version:"1.1",baseProfile:"full",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",style:ie({width:"100%",height:"100%"},G),id:p},g.createElement("g",{id:p+"__eraser-stroke-group",display:"none"},g.createElement("rect",{id:p+"__mask-background",x:"0",y:"0",width:"100%",height:"100%",fill:"white"}),t.map(function(s,a){return g.createElement(je,{key:p+"__eraser-"+a,id:p+"__eraser-"+a,paths:s.paths,strokeColor:"#000000",strokeWidth:s.strokeWidth})})),g.createElement("defs",null,A&&g.createElement("pattern",{id:p+"__background",x:"0",y:"0",width:"100%",height:"100%",patternUnits:"userSpaceOnUse"},g.createElement("image",{x:"0",y:"0",width:"100%",height:"100%",xlinkHref:A,preserveAspectRatio:$})),t.map(function(s,a){return g.createElement("mask",{id:p+"__eraser-mask-"+a,key:p+"__eraser-mask-"+a,maskUnits:"userSpaceOnUse"},g.createElement("use",{href:"#"+p+"__mask-background"}),Array.from({length:t.length-a},function(m,x){return x+a}).map(function(m){return g.createElement("use",{key:m.toString(),href:"#"+p+"__eraser-"+m.toString()})}))})),g.createElement("g",{id:p+"__canvas-background-group"},g.createElement("rect",{id:p+"__canvas-background",x:"0",y:"0",width:"100%",height:"100%",fill:A?"url(#"+p+"__background)":W})),o.map(function(s,a){return g.createElement("g",{id:p+"__stroke-group-"+a,key:p+"__stroke-group-"+a,mask:"url(#"+p+"__eraser-mask-"+a+")"},g.createElement(Xe,{id:p,paths:s}))})))}),qe=g.forwardRef(function(c,u){var i=c.id,f=i===void 0?"react-sketch-canvas":i,d=c.width,v=d===void 0?"100%":d,w=c.height,N=w===void 0?"100%":w,p=c.className,C=p===void 0?"":p,b=c.canvasColor,M=b===void 0?"white":b,F=c.strokeColor,O=F===void 0?"red":F,Y=c.backgroundImage,z=Y===void 0?"":Y,W=c.exportWithBackgroundImage,T=W===void 0?!1:W,A=c.preserveBackgroundImageAspectRatio,q=A===void 0?"none":A,D=c.strokeWidth,V=D===void 0?4:D,$=c.eraserWidth,L=$===void 0?8:$,E=c.allowOnlyPointerType,Z=E===void 0?"all":E,X=c.style,ae=X===void 0?{border:"0.0625rem solid #9c9c9c",borderRadius:"0.25rem"}:X,G=c.svgStyle,ee=G===void 0?{}:G,K=c.onChange,J=K===void 0?function(I){}:K,H=c.onStroke,Q=H===void 0?function(I,y){}:H,t=c.withTimestamp,e=t===void 0?!1:t,o=g.createRef(),s=g.useState(!0),a=s[0],m=s[1],x=g.useState(!1),r=x[0],l=x[1],h=g.useState([]),k=h[0],S=h[1],_=g.useState([]),U=_[0],ne=_[1],oe=g.useState([]),B=oe[0],te=oe[1],P=g.useCallback(function(){var I,y,j=(I=(y=B.slice(-1))==null?void 0:y[0])!=null?I:null;if(j===null){console.warn("No stroke found!");return}Q(j,!j.drawMode)},[r]);g.useEffect(function(){P()},[r]),g.useEffect(function(){J(B)},[B]),g.useImperativeHandle(u,function(){return{eraseMode:function(y){m(!y)},clearCanvas:function(){S([].concat(B)),te([])},undo:function(){if(k.length!==0){te([].concat(k)),S([]);return}ne(function(y){return[].concat(y,B.slice(-1))}),te(function(y){return y.slice(0,-1)})},redo:function(){U.length!==0&&(te(function(y){return[].concat(y,U.slice(-1))}),ne(function(y){return y.slice(0,-1)}))},exportImage:function(y){var j,R=(j=o.current)==null?void 0:j.exportImage;if(R)return R(y);throw Error("Export function called before canvas loaded")},exportSvg:function(){return new Promise(function(y,j){var R,re=(R=o.current)==null?void 0:R.exportSvg;re?re().then(function(se){y(se)}).catch(function(se){j(se)}):j(Error("Export function called before canvas loaded"))})},exportPaths:function(){return new Promise(function(y,j){try{y(B)}catch(R){j(R)}})},loadPaths:function(y){te(function(j){return[].concat(j,y)})},getSketchingTime:function(){return new Promise(function(y,j){e||j(new Error("Set 'withTimestamp' prop to get sketching time"));try{var R=B.reduce(function(re,se){var ge,fe,Pe=(ge=se.startTimestamp)!=null?ge:0,_e=(fe=se.endTimestamp)!=null?fe:0;return re+(_e-Pe)},0);y(R)}catch(re){j(re)}})},resetCanvas:function(){S([]),ne([]),te([])}}});var ce=function(y){l(!0),ne([]);var j={drawMode:a,strokeColor:a?O:"#000000",strokeWidth:a?V:L,paths:[y]};e&&(j=ie({},j,{startTimestamp:Date.now(),endTimestamp:0})),te(function(R){return[].concat(R,[j])})},le=function(y){if(r){var j=B.slice(-1)[0],R=ie({},j,{paths:[].concat(j.paths,[y])});te(function(re){return[].concat(re.slice(0,-1),[R])})}},ue=function(){var y,j;if(r&&(l(!1),!!e)){var R=(y=(j=B.slice(-1))==null?void 0:j[0])!=null?y:null;if(R!==null){var re=ie({},R,{endTimestamp:Date.now()});te(function(se){return[].concat(se.slice(0,-1),[re])})}}};return g.createElement(He,{ref:o,id:f,width:v,height:N,className:C,canvasColor:M,backgroundImage:z,exportWithBackgroundImage:T,preserveBackgroundImageAspectRatio:q,allowOnlyPointerType:Z,style:ae,svgStyle:ee,paths:B,isDrawing:r,onPointerDown:ce,onPointerMove:le,onPointerUp:ue})});const et=({lang:c})=>{const u=Te[c].design,[i,f]=g.useState([{id:"page-1",elements:[]}]),[d,v]=g.useState(0),[w,N]=g.useState(""),[p,C]=g.useState(""),[b,M]=g.useState(""),[F,O]=g.useState(!1),[Y,z]=g.useState(!1),[W,T]=g.useState("#000000"),[A,q]=g.useState(4),[D,V]=g.useState(!1),$=g.useRef(null),L=g.useRef(null),[E,Z]=g.useState(null),[X,ae]=g.useState({x:0,y:0}),G=i[d],ee=()=>{f([...i,{id:`page-${Date.now()}`,elements:[]}]),v(i.length)},K=r=>{if(i.length===1){de.error("You must have at least one page.");return}const l=i.filter((h,k)=>k!==r);f(l),d>=l.length&&v(l.length-1)},J=r=>{f(l=>l.map((h,k)=>k===d?{...h,elements:r}:h))},H=(r,l)=>{const h={id:Date.now().toString(),type:r,content:l,x:Math.random()*200+50,y:Math.random()*200+50,scale:1};J([...G.elements,h])},Q=r=>{J(G.elements.filter(l=>l.id!==r))},t=()=>{const r=prompt("Enter your text:","Hello World");r&&H("text",r)},e=async()=>{if(L.current){const r=await L.current.exportImage("png");H("image",r),z(!1),de.success("Drawing added to story!")}},o=async()=>{if(!w&&G.elements.length===0)return;O(!0),M("");const r=i.flatMap(h=>h.elements).filter(h=>h.type==="sticker").map(h=>{const k=pe.find(S=>S.icon===h.content);return k?k.name:"Unknown Object"}),l=await Ue(w||"Untitled",r,c);M(l),O(!1)},s=(r,l,h,k)=>{if(r.stopPropagation(),Z(l),$.current){const S=$.current.getBoundingClientRect(),_=r.clientX-S.left,U=r.clientY-S.top;ae({x:_-h,y:U-k})}},a=r=>{if(E&&$.current){const l=$.current.getBoundingClientRect(),h=r.clientX-l.left,k=r.clientY-l.top,S=h-X.x,_=k-X.y;J(G.elements.map(U=>U.id===E?{...U,x:S,y:_}:U))}},m=()=>{Z(null)},x=async()=>{if(!$.current)return;const r=de.loading("Generating PDF Book...");try{const l=new Ce("p","mm","a4"),h=l.internal.pageSize.getWidth(),k=l.internal.pageSize.getHeight();if(l.setFontSize(30),l.text(w||"My Story",h/2,40,{align:"center"}),p&&(l.setFontSize(18),l.text("Written & Illustrated by:",h/2,60,{align:"center"}),l.setFontSize(22),l.text(p,h/2,75,{align:"center"})),b){l.addPage(),l.setFontSize(14);const oe=l.splitTextToSize(b,h-40);l.text(oe,20,20)}l.addPage();const _=(await Ee($.current,{scale:2})).toDataURL("image/png"),U=l.getImageProperties(_),ne=U.height*(h-40)/U.width;l.addImage(_,"PNG",20,20,h-40,ne),l.text(`Page ${d+1}`,h/2,k-10,{align:"center"}),l.save(`${w||"story"}.pdf`),de.success("PDF Downloaded!",{id:r})}catch(l){console.error(l),de.error("Failed to generate PDF",{id:r})}};return n.jsxs("div",{className:"min-h-screen bg-background dark:bg-dark-bg py-8 px-4 transition-colors duration-300",onMouseUp:m,children:[n.jsxs("div",{className:"max-w-7xl mx-auto",children:[n.jsxs("div",{className:"flex justify-between items-center mb-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:`text-3xl font-bold text-gray-800 dark:text-white ${c==="ar"?"text-right font-arabic":""}`,children:u.title}),n.jsx("p",{className:`text-gray-500 dark:text-gray-400 ${c==="ar"?"text-right font-arabic":""}`,children:u.subtitle})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs("button",{onClick:()=>z(!0),className:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-xl font-bold flex items-center gap-2 shadow-md",children:[n.jsx(me,{size:18}),"Draw"]}),n.jsxs("button",{onClick:x,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-xl font-bold flex items-center gap-2 shadow-md",children:[n.jsx(De,{size:18}),"Export PDF"]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[n.jsxs("div",{className:"lg:col-span-3 space-y-6",children:[n.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl shadow-sm p-5 border border-gray-100 dark:border-gray-700",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 dark:text-white",children:"Story Details"}),n.jsxs("div",{className:"space-y-3",children:[n.jsx("input",{type:"text",value:w,onChange:r=>N(r.target.value),placeholder:u.placeholderTitle,className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"}),n.jsx("input",{type:"text",value:p,onChange:r=>C(r.target.value),placeholder:"Author Name",className:"w-full px-3 py-2 border rounded-lg dark:bg-gray-800 dark:border-gray-600 dark:text-white"})]})]}),n.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-2xl shadow-sm p-5 border border-gray-100 dark:border-gray-700",children:[n.jsx("h3",{className:"font-bold text-lg mb-4 dark:text-white",children:"Add Elements"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[n.jsxs("button",{onClick:t,className:"flex flex-col items-center justify-center p-3 bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 rounded-xl hover:bg-blue-100 transition-colors",children:[n.jsx(Me,{size:24}),n.jsx("span",{className:"text-xs font-bold mt-1",children:"Text"})]}),n.jsxs("button",{onClick:()=>z(!0),className:"flex flex-col items-center justify-center p-3 bg-purple-50 dark:bg-purple-900/20 text-purple-600 dark:text-purple-300 rounded-xl hover:bg-purple-100 transition-colors",children:[n.jsx(me,{size:24}),n.jsx("span",{className:"text-xs font-bold mt-1",children:"Draw"})]})]}),n.jsx("h4",{className:"text-sm font-bold text-gray-500 mb-2",children:"Stickers"}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:pe.map(r=>n.jsx("button",{onClick:()=>H("sticker",r.icon),className:"aspect-square bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 rounded-lg text-2xl flex items-center justify-center border border-gray-200 dark:border-gray-700",children:r.icon},r.id))})]}),n.jsx("button",{onClick:o,disabled:F,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-primary to-secondary text-white py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transition-all disabled:opacity-50",children:F?n.jsx("span",{children:"Generating..."}):n.jsxs(n.Fragment,{children:[n.jsx($e,{size:20})," Generate Story"]})})]}),n.jsxs("div",{className:"lg:col-span-9 space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between bg-white dark:bg-dark-card p-3 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>v(Math.max(0,d-1)),disabled:d===0,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-30",children:n.jsx(Le,{size:20})}),n.jsxs("span",{className:"font-bold dark:text-white",children:["Page ",d+1," of ",i.length]}),n.jsx("button",{onClick:()=>v(Math.min(i.length-1,d+1)),disabled:d===i.length-1,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg disabled:opacity-30",children:n.jsx(Re,{size:20})})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs("button",{onClick:()=>K(d),className:"text-red-500 hover:bg-red-50 px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-1",children:[n.jsx(ve,{size:16})," Delete Page"]}),n.jsxs("button",{onClick:ee,className:"bg-primary text-white px-3 py-1.5 rounded-lg text-sm font-bold flex items-center gap-1",children:[n.jsx(Fe,{size:16})," New Page"]})]})]}),n.jsxs("div",{ref:$,className:"relative aspect-[16/9] bg-white rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden cursor-crosshair",onMouseMove:a,onMouseLeave:m,children:[n.jsx("div",{className:"absolute inset-0 opacity-5 pointer-events-none",style:{backgroundImage:"radial-gradient(#000 1px, transparent 1px)",backgroundSize:"20px 20px"}}),G.elements.map(r=>n.jsxs("div",{className:`absolute cursor-grab active:cursor-grabbing hover:ring-2 ring-primary rounded-lg transition-all select-none group ${E===r.id?"z-50 scale-105":"z-10"}`,style:{left:`${r.x}px`,top:`${r.y}px`},onMouseDown:l=>s(l,r.id,r.x,r.y),children:[r.type==="sticker"&&n.jsx("span",{style:{fontSize:"4rem"},children:r.content}),r.type==="text"&&n.jsx("div",{className:"bg-white/80 backdrop-blur-sm px-3 py-1 rounded-lg border border-gray-200 shadow-sm min-w-[50px]",children:n.jsx("p",{className:"text-xl font-bold text-gray-800 font-comic",children:r.content})}),r.type==="image"&&n.jsx("img",{src:r.content,alt:"drawing",className:"w-48 h-auto object-contain pointer-events-none"}),n.jsx("button",{onClick:l=>{l.stopPropagation(),Q(r.id)},className:"absolute -top-3 -right-3 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm",children:n.jsx(xe,{size:12})})]},r.id)),G.elements.length===0&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-300 pointer-events-none",children:n.jsxs("div",{className:"text-center",children:[n.jsx(ze,{size:48,className:"mx-auto mb-2 opacity-50"}),n.jsx("p",{className:"text-xl font-bold",children:"Start Designing!"}),n.jsx("p",{className:"text-sm",children:"Drag stickers, add text, or draw something."})]})})]}),b&&n.jsxs("div",{className:"bg-white dark:bg-dark-card rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 animate-slide-up",children:[n.jsx("h3",{className:"font-bold text-lg mb-2 dark:text-white",children:"AI Story"}),n.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-line",children:b})]})]})]})]}),Y&&n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:n.jsxs("div",{className:"bg-white dark:bg-dark-card w-full max-w-4xl h-[80vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden animate-scale-in",children:[n.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[n.jsx("h3",{className:"font-bold text-xl dark:text-white",children:"Drawing Pad"}),n.jsx("button",{onClick:()=>z(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:n.jsx(xe,{})})]}),n.jsx("div",{className:"flex-1 relative bg-white cursor-crosshair",children:n.jsx(qe,{ref:L,strokeWidth:A,strokeColor:D?"#FFFFFF":W,canvasColor:"transparent",style:{border:"none"}})}),n.jsxs("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 flex flex-wrap gap-4 items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx("div",{className:"flex gap-1",children:["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF"].map(r=>n.jsx("button",{onClick:()=>{T(r),V(!1)},className:`w-8 h-8 rounded-full border-2 ${W===r&&!D?"border-gray-400 scale-110":"border-transparent"}`,style:{backgroundColor:r}},r))}),n.jsx("div",{className:"h-8 w-px bg-gray-300 dark:bg-gray-600"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("button",{onClick:()=>V(!D),className:`p-2 rounded-lg ${D?"bg-blue-100 text-blue-600":"hover:bg-gray-200 dark:hover:bg-gray-700"}`,title:"Eraser",children:n.jsx(We,{size:20})}),n.jsx("input",{type:"range",min:"1",max:"20",value:A,onChange:r=>q(parseInt(r.target.value)),className:"w-24"})]}),n.jsx("div",{className:"h-8 w-px bg-gray-300 dark:bg-gray-600"}),n.jsxs("div",{className:"flex gap-1",children:[n.jsx("button",{onClick:()=>{var r;return(r=L.current)==null?void 0:r.undo()},className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg",children:n.jsx(Oe,{size:20})}),n.jsx("button",{onClick:()=>{var r;return(r=L.current)==null?void 0:r.redo()},className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg",children:n.jsx(Ae,{size:20})}),n.jsx("button",{onClick:()=>{var r;return(r=L.current)==null?void 0:r.clearCanvas()},className:"p-2 hover:bg-red-100 text-red-500 rounded-lg",children:n.jsx(ve,{size:20})})]})]}),n.jsxs("button",{onClick:e,className:"bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-xl font-bold shadow-lg flex items-center gap-2",children:[n.jsx(Ge,{size:18})," Add to Story"]})]})]})})]})};export{et as DesignStudio};
